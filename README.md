# Sleep Tracker API

**This api is made to work with the project named above built by a team consisting of UI/UX Web, React FrontEnd, and Backend developers**

<br >

## Table of Contents

1) [Introduction](https://github.com/Build-Week-Sleeping-Tracker/back-end#introduction) - Describe the purpose of this repository and information about using a .env file.
2) [Schema](https://github.com/Build-Week-Sleeping-Tracker/back-end#schema) - Shows the tables on the database with the field data types, and mentions required fields
    - 2.1 [Users Schema](https://github.com/Build-Week-Sleeping-Tracker/back-end#users)
    - 2.2 [Entries Schema](https://github.com/Build-Week-Sleeping-Tracker/back-end#entries)
3) [API Endpoints](https://github.com/Build-Week-Sleeping-Tracker/back-end#api-endpoints) - Documentation for the endpoints available in the api
    - 3.1 [Authentication](https://github.com/Build-Week-Sleeping-Tracker/back-end#authentication) - Post requests for login and register of users
    - 3.2 [Restricted Endpoints](https://github.com/Build-Week-Sleeping-Tracker/back-end#restricted-endpoints-require-token)
        - 3.2.1 [Users Endpoints](https://github.com/Build-Week-Sleeping-Tracker/back-end#users-1) - All endpoints available for users table
        - 3.2.2 [Sleep Entries Endpoints](https://github.com/Build-Week-Sleeping-Tracker/back-end#sleep-entries) - All endpoints available for sleep entries table

<br>

## Introduction
<br>

This api will provide the resources necessary on the React App to log in, out, and display data for users to use. The complete project is built
in a two week period where the team collaborates to get all essential items connected to each other to make one app for the user.

**Make sure to add a .env file with at least the following:**
```
    PORT=5000
    NODE_ENV=development
    DATABASE_URL=postgres://postgres:<postgres_password>@localhost:5432/<database_name_in_postgres>

    JWT_SECRET=your secret here... you can convert it to any type of hash online if you like
```

Convert Secret or anything to hash -> [Click Here!](https://www.md5hashgenerator.com/)
- This will convert the secret to an MD5 Hash string
- You can use any hash generator online, just Google **Hash Generator**

<br><br>

## Schema

### Users

| Fieldname   | Data Type                                        |
|-------------|--------------------------------------------------|
| id          | Primary Key - Int - Generated By Database        |
| fname       | String - Required                                |
| lname       | String - Required                                |
| email       | String - Required - Unique                       |
| username    | String - Required - Unique                       |
| password    | String - Required - Hashed/Encrypted upon signup |


<br>

### Entries

| Fieldname         | Data Type                                                            |
|-------------------|----------------------------------------------------------------------|
| id                | Primary Key - Int - Generated By Database                            |
| sleep_start       | Datetime - Required                                                  |
| sleep_end         | Datetime                                                             |
| daytime_mood      | Integer - Range between 1 - 4                                        |
| sleep_start_mood  | Integer - Range between 1 - 4                                        |
| sleep_end_mood    | Integer - Range between 1 - 4                                        |
| sleep_time_total  | Time - Will auto generate when both start and end times are provided |
| user_id           | Integer - Required - Must be the logged on user id                   |

**The mood values will automatically get set within range if outside the 1 - 4 range.**
If value is > 4 it will be changed to 4, if < 1 it will be set to 1. 

<br><br>


# API Endpoints
Deployed to Heroku: [Backend Api](https://webpt15-sleep-tracker-api.herokuapp.com)

BASE URL: https://webpt15-sleep-tracker-api.herokuapp.com

To use the api, requests are called with base url followed by the endpoint path.
For example: **[base url]/api/users**

Most endpoints receive and return JSON
<br><br>

### Authentication

| Method | Endpoint               | Description                                                                  |
|--------|------------------------|------------------------------------------------------------------------------|
| POST   | /api/auth/register     | Creates a user. Requires First Name, Last Name, Email, Username, and Password. Returns the user id, username, and a token. |
| POST   | /api/auth/login        | Logs user in taking the username and password provided. Returns User Id, Username, and Token. |

___
<br>

`POST /api/auth/register`

**Receives**
```json
{
    "fname": "Test",
    "lname": "Tester",
    "email": "tester@testing.com",
    "username": "tester",
    "password": "test123"
}
```

**Returns**
```json
{
    "user_id": 1,
    "username": "tester",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NSwibmFtZSI6IkFsaWNlIiwiZW1haWwiOiJhbGljZUBnbWFpbC5jb20iLCJyb2xlcyI6WyJTVFVERU5UIl0sImlhdCI6MTU5MjYxODM4MiwiZXhwIjoxNTkyNjI1NTgyfQ.JCn_0iOCptEmJ7xIKBf4tOPHZanncar719n0mGdHiI8"
}
```
<br>

____

<br>

`POST /api/auth/login`

**Receives**
```json
{
    "username": "tester",
    "password": "test123"
}
```

**Returns**
```json
{
    "user_id": 1,
    "username": "tester",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NSwibmFtZSI6IkFsaWNlIiwiZW1haWwiOiJhbGljZUBnbWFpbC5jb20iLCJyb2xlcyI6WyJTVFVERU5UIl0sImlhdCI6MTU5MjYxODM4MiwiZXhwIjoxNTkyNjI1NTgyfQ.JCn_0iOCptEmJ7xIKBf4tOPHZanncar719n0mGdHiI8"
}
```
<br>

___

<br>

## Restricted Endpoints (Require Token)

Using Authentication Token for the endpoints beyond this point. Make sure to add the keyword **Bearer** with the token in the Authorization header.

For Example:
```js
// If creating an axiosWithAuth file
axios.create({
    headers: {
        Authorization: `Bearer ${token}`,
    },
});

// If adding the authorization on the axios call
axios.get("https://webpt15-sleep-tracker-api.herokuapp.com/api/users", {headers: {Authorization: `Bearer ${token}` } });
```

Either way you use the token, just be sure to add "Bearer" before the token separated by a space.

<br><br>


### Users
<br>

| Method | URL            | Description                                                                   |
| ------ | -------------- | ----------------------------------------------------------------------------- |
| GET    | /api/users/:id | Returns profile info for user by id                                           |
| PUT    | /api/users/:id | Updates user info for user by id. Users can only update their own data        |
| DELETE | /api/users/:id | Deletes user for user by id. Users can only delete their own account          |

<br>

`GET /api/users/:id`

**Returns**
```json
{
    "id": 1,
    "fname": "Test",
    "lname": "Tester",
    "email": "tester@testing.com",
    "username": "tester",
    "password": "test123"
}
```
<br>

___
<br>

`PUT /api/users/:id`

**Receives** (fields that do not change can be ommitted)
```json
{
    "fname": "Test",
    "lname": "Tester",
    "email": "tester@testing.com",
    "username": "tester",
    "password": "test123"
}
```

**Returns**
```json
{
    "id": 1,
    "fname": "Test",
    "lname": "Tester",
    "email": "tester@testing.com",
    "username": "tester"
}
```
<br>

___
<br>

`DELETE /api/users/:id`

Does not receive or return JSON

**Returns**
```- Status: 204 = No Content ```

<br>


___

<br><br>


### Sleep Entries
<br>

| Method | URL            | Description                                                                   |
| ------ | -------------- | ----------------------------------------------------------------------------- |
| GET    | /api/sleep     | Returns an array of sleep entries for the logged on user.                     |
| GET    | /api/sleep/:id | Returns the sleep entry by id for the logged on user.                         |
| POST   | /api/sleep     | Creates new sleep entry for logged on user. Requires sleep start time and user id |
| PUT    | /api/sleep/:id | Updates sleep entry by id for logged on user. Just provide the properties being changed |
| DELETE | /api/sleep/:id | Deletes sleep entry by id for logged on user.                                 |

<br>

`GET /api/sleep`

**Returns**
```json
[
    {
      "id": 1,
      "sleep_start": 1597869337330,
      "sleep_end": null,
      "daytime_mood": 3,
      "sleep_start_mood": 1,
      "sleep_end_mood": null,
      "sleep_time_total": null,
      "user_id": 1
    },
    {
      "id": 2,
      "sleep_start": 1597869337330,
      "sleep_end": 1597869337330,
      "daytime_mood": 3,
      "sleep_start_mood": 1,
      "sleep_end_mood": 3,
      "sleep_time_total": 3,
      "user_id": 1
    },

]
```

<br>

___
<br>

`GET /api/sleep/:id`

**Returns**
```json
{
    "id": 1,
    "sleep_start": 1597869337330,
    "sleep_end": null,
    "daytime_mood": 3,
    "sleep_start_mood": 1,
    "sleep_end_mood": null,
    "sleep_time_total": null,
    "user_id": 1
}
```

<br>

___
<br>

`POST /api/sleep`

**Receives**
```json
{
    "sleep_start": 1597869337330,
    "user_id": 1
}
```
You may add any other property if have a value for them, otherwise, 
only sleep_start and user_id are required

<br>

**Returns**
```json
{
    "id": 1,
    "sleep_start": 1597869337330,
    "sleep_end": null,
    "daytime_mood": 3,
    "sleep_start_mood": 1,
    "sleep_end_mood": null,
    "sleep_time_total": null,
    "user_id": 1
}
```

<br>

___
<br>

` PUT /api/sleep/:id`

**Receives** (fields that do not change can be omitted)
```json
{
    "id": 1,
    "sleep_start": 1597869337330,
    "sleep_end": null,
    "daytime_mood": 3,
    "sleep_start_mood": 1,
    "sleep_end_mood": null,
    "sleep_time_total": null,
    "user_id": 1
}
```

**Returns**
```json
{
      "id": 1,
      "sleep_start": 1597869337330,
      "sleep_end": 1597869337330,
      "daytime_mood": 3,
      "sleep_start_mood": 1,
      "sleep_end_mood": 3,
      "sleep_time_total": 3,
      "user_id": 1
    }
```

<br>

___
<br>

`DELETE /api/sleep/:id`

Does not receive or return JSON

**Returns**
```- Status: 204 = No Content ```
